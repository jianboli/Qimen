<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qimen Grid App</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>十天干与九宫八卦</h1>
        </header>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-button active" data-tab="qimen-tab">奇门遁甲</button>
            <button class="tab-button" data-tab="bagua-tab">八卦图</button>
        </div>

        <main>
            <!-- Qimen Tab Content -->
            <div id="qimen-tab" class="tab-content active">
            <div class="controls">
                <div class="control-group">
                    <label for="direction">五遁</label>
                    <select id="direction">
                        <option value="ascending" selected>阳遁</option>
                        <option value="descending">阴遁</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="startPosition">九宫</label>
                    <select id="startPosition">
                        <option value="1" selected>1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                    </select>
                </div>



                <button id="fillGrid" class="btn-primary">Fill Grid</button>
                <button id="clearGrid" class="btn-secondary">Clear Grid</button>
            </div>

            <div class="grid-container">
                <div class="grid">
                    <div class="grid-cell" data-position="4" data-grid-number="4">
                        <span class="position-number">4</span>
                        <span class="character"></span>
                    </div>
                    <div class="grid-cell" data-position="9" data-grid-number="9">
                        <span class="position-number">9</span>
                        <span class="character"></span>
                    </div>
                    <div class="grid-cell" data-position="2" data-grid-number="2">
                        <span class="position-number">2</span>
                        <span class="character"></span>
                    </div>
                    <div class="grid-cell" data-position="3" data-grid-number="3">
                        <span class="position-number">3</span>
                        <span class="character"></span>
                    </div>
                    <div class="grid-cell" data-position="5" data-grid-number="5">
                        <span class="position-number">5</span>
                        <span class="character"></span>
                    </div>
                    <div class="grid-cell" data-position="7" data-grid-number="7">
                        <span class="position-number">7</span>
                        <span class="character"></span>
                    </div>
                    <div class="grid-cell" data-position="8" data-grid-number="8">
                        <span class="position-number">8</span>
                        <span class="character"></span>
                    </div>
                    <div class="grid-cell" data-position="1" data-grid-number="1">
                        <span class="position-number">1</span>
                        <span class="character"></span>
                    </div>
                    <div class="grid-cell" data-position="6" data-grid-number="6">
                        <span class="position-number">6</span>
                        <span class="character"></span>
                    </div>
                </div>
            </div>

            <div class="sequence-display">
                <table class="qimen-table">
                    <tr>
                        <td>六甲</td>
                        <td>一甲</td>
                        <td>二甲</td>
                        <td>三甲</td>
                        <td>四甲</td>
                        <td>五甲</td>
                        <td>六甲</td>
                        <td colspan="3">三奇</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>甲子</td>
                        <td>甲戌</td>
                        <td>甲申</td>
                        <td>甲午</td>
                        <td>甲辰</td>
                        <td>甲寅</td>
                        <td>星奇</td>
                        <td>月奇</td>
                        <td>日奇</td>
                    </tr>
                    <tr>
                        <td>六仪</td>
                        <td>戊</td>
                        <td>己</td>
                        <td>庚</td>
                        <td>辛</td>
                        <td>壬</td>
                        <td>癸</td>
                        <td>丁</td>
                        <td>丙</td>
                        <td>乙</td>
                    </tr>
                </table>
            </div>
            </div>

            <!-- Bagua Tab Content -->
            <div id="bagua-tab" class="tab-content">
                <div class="bagua-container">
                    <h2>九宫八卦图</h2>
                    <p class="bagua-description"></p>
                    <div class="bagua-svg-container">
                        <svg width="400" height="400"></svg>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Include D3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- Bagua UI functionality -->
    <script src="bagua-ui.js"></script>
    <!-- Tab functionality script -->
    <script>
        // Tab switching functionality
        document.addEventListener('DOMContentLoaded', function() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetTab = this.dataset.tab;

                    // Remove active class from all buttons and contents
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));

                    // Add active class to clicked button and corresponding content
                    this.classList.add('active');
                    document.getElementById(targetTab).classList.add('active');

                    // Initialize bagua if switching to bagua tab
                    if (targetTab === 'bagua-tab') {
                        // Clear and reinitialize the SVG
                        d3.select('#bagua-tab svg').selectAll('*').remove();
                        // Re-run bagua.js code
                        initializeBagua();
                    }
                });
            });


        });
    </script>
    <script src="renderer.js"></script>
</body>
</html>
